visualise_landscape(landscape)
centroids <- st_coordinates(st_centroid(st_geometry(landscape)))
dist_mat <- as.matrix(dist(centroids))
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 90)
?sparseMatrix
library(sf)
library(nngeo)
library(Matrix)
# Host growth
host_growth <- function(H, P, lambda, a) {
lambda * H * exp(-log(lambda) * H) * exp(-P * a)
}
# Parasitoid growth
parasitoid_growth <- function(H, P, lambda, a) {
a * H * (1 - exp(-P)) * exp(-log(lambda) * H)
}
# Dispersal kernel
dispersal_kernel <- function(d_ij, d_bar_x) {
(2 / (pi * d_bar_x^2)) * exp(-2 * d_ij / d_bar_x)
}
# Sparsify dispersal
sparse_kernel <- function(landscape, d_bar_x, maxdist_mult = 4) {
n <- nrow(landscape) # number of cells
maxdist <- maxdist_mult * d_bar_x # max dispersal distance
# Decide possible destinations for each cell (Ignore computing dispersal to cells further than maxdist)
nb <- st_nn(x = landscape, y = landscape, k = n, maxdist = maxdist, progress = FALSE)
rows <- rep(1:n, lengths(nb) + 1) # big vector of all origin cells. Repeat origin for each destination
cols <- unlist( # big vector of all destinations for each origin cell. unlist turns list into one big vector
lapply(
1:n, # for each cell
function(i) c(i, nb[[i]]))) # make pairs: `cell index` paired with `possible destination`
# Get distances
coords <- st_coordinates(st_centroid(landscape)) # Set coordinates to cell centroids
diffcells <- coords[rows, , drop = FALSE] - coords[cols, , drop = FALSE] # differences between coordinates of possible paths
dists <- sqrt(rowSums(diffcells^2))
weights <- dispersal_kernel(dists, d_bar_x)   # compute kernel weights
# assemble sparse matrix (rows = origin, cols = destination)
K <- sparseMatrix(i = rows, j = cols, x = weights, dims = c(n, n))
# Here normalize rows if you don't want absorbing conditions
return(K)
}
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 40) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
centroids <- st_coordinates(st_centroid(st_geometry(landscape)))
dist_mat <- as.matrix(dist(centroids))
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 90)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
install.packages("tidyllm")
View(K)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 120)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 180)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 280)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
# Load an image
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
centroids <- st_coordinates(st_centroid(st_geometry(landscape)))
dist_mat <- as.matrix(dist(centroids))
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 100)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
H
View(K)
as.matrix(K)
visualise_landscape(landscape)
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
# Generate sparse dispersal kerne3
K <- sparse_kernel(landscape, d_bar_x = 100)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 300)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
as.matrix(K)
View(landscape)
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
centroids <- st_coordinates(st_centroid(st_geometry(landscape)))
dist_mat <- as.matrix(dist(centroids))
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 300)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
visualise_landscape(landscape)
dist_mat
View(landscape)
View(landscape)
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
visualise_landscape(landscape)
View(landscape)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
View(landscape)
View(landscape)
View(landscape)
View(landscape)
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
visualise_landscape(landscape)
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
?st_nn
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
source("code/model.R")
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
visualise_landscape(landscape)
K
View(K)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 3)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 5)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(1)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
K
landscape
K
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
H
H_next
# Disperse
H_next <- K %*% H
H_next
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 5)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
K
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 5)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
View(weights)
View(dists)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
K
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 2)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 1)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
source("code/mapping.R")
source("code/model.R")
# Generate and process the landscape
# landscape <- create_hex_landscape()
# Load an image as landscape
landscape <- load_landscape("images/blobs.png",
scale = 0.5,# Set scale <1 to shrink image
cellsize = 80) # set cellsize <8 to make a finer hex grid overlay
visualise_landscape(landscape)
# Generate sparse dispersal kernel
K <- sparse_kernel(landscape, d_bar_x = 1)
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
visualise_landscape(landscape)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
ggplot(landscape) +
geom_sf(aes(fill = H_next)) +
scale_fill_viridis_c() +
theme_void()
# Initialize host distribution
H <- rep(0, nrow(landscape))
H[c(6)] <- 1
# Disperse
H_next <- K %*% H
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
H
H_next
K
# Visualize
landscape$H <- as.numeric(H_next)
ggplot(landscape) +
geom_sf(aes(fill = H)) +
scale_fill_viridis_c() +
theme_void()
landscape
H_next
K
H
K
